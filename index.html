<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CivicSense - Report Issues, Build Better Cities</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e40af',
                        secondary: '#3b82f6',
                        accent: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        success: '#22c55e'
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .pulse-marker { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .timeline-line { position: relative; }
        .timeline-line::before { content: ''; position: absolute; left: 15px; top: 0; bottom: 0; width: 2px; background: #e5e7eb; }
        .timeline-item { position: relative; padding-left: 40px; }
        .timeline-dot { position: absolute; left: 8px; top: 8px; width: 16px; height: 16px; border-radius: 50%; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-primary">üèõÔ∏è CivicSense</h1>
                    </div>
                    <div class="hidden md:block ml-10">
                        <div class="flex items-baseline space-x-4">
                            <a href="#" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">Home</a>
                            <a href="#" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">Issues</a>
                            <a href="#" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">About</a>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="emergencyBtn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm font-medium animate-pulse">üö® Emergency</button>
                    <button id="loginBtn" class="text-gray-700 hover:text-primary px-3 py-2 rounded-md text-sm font-medium">Login</button>
                    <button id="signupBtn" class="bg-primary hover:bg-secondary text-white px-4 py-2 rounded-lg text-sm font-medium">Sign Up</button>
                    <div id="userMenu" class="hidden flex items-center space-x-2">
                        <div class="relative">
                            <button id="notificationBtn" class="relative p-2 text-gray-600 hover:text-primary">
                                üîî
                                <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">3</span>
                            </button>
                        </div>
                        <span id="userName" class="text-gray-700 text-sm font-medium"></span>
                        <button id="logoutBtn" class="text-red-600 hover:text-red-800 text-sm">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="gradient-bg text-white py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl md:text-6xl font-bold mb-6 fade-in">Report Civic Issues, Get Solutions, Build a Better City</h1>
            <p class="text-xl md:text-2xl mb-8 opacity-90 fade-in">Connect directly with your municipal corporation for faster resolutions and transparent governance</p>
            <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4 fade-in">
                <button id="heroReportBtn" class="bg-accent hover:bg-green-600 text-white px-8 py-4 rounded-lg text-lg font-semibold shadow-lg transform hover:scale-105 transition-all">
                    üì± Report Issue Now
                </button>
                <button id="heroViewBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-8 py-4 rounded-lg text-lg font-semibold backdrop-blur-sm">
                    üó∫Ô∏è View Issues Map
                </button>
            </div>
        </div>
    </section>

    <!-- Quick Stats -->
    <section class="py-12 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <div class="text-center p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
                    <div class="text-3xl font-bold text-primary mb-2" id="totalIssues">1,247</div>
                    <div class="text-sm text-gray-600">Total Reports</div>
                </div>
                <div class="text-center p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-xl">
                    <div class="text-3xl font-bold text-success mb-2" id="resolvedIssues">1,089</div>
                    <div class="text-sm text-gray-600">Resolved</div>
                </div>
                <div class="text-center p-6 bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl">
                    <div class="text-3xl font-bold text-warning mb-2" id="avgResolutionTime">2.3</div>
                    <div class="text-sm text-gray-600">Avg Days</div>
                </div>
                <div class="text-center p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
                    <div class="text-3xl font-bold text-purple-600 mb-2" id="userSatisfaction">4.8</div>
                    <div class="text-sm text-gray-600">User Rating</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Navigation Tabs -->
        <div class="flex flex-wrap justify-center mb-8 bg-white rounded-xl shadow-lg p-2">
            <button class="tab-btn active px-6 py-3 rounded-lg text-sm font-medium mx-1 mb-2 transition-all" data-tab="dashboard">üìä Dashboard</button>
            <button class="tab-btn px-6 py-3 rounded-lg text-sm font-medium mx-1 mb-2 transition-all" data-tab="report">üìù Report Issue</button>
            <button class="tab-btn px-6 py-3 rounded-lg text-sm font-medium mx-1 mb-2 transition-all" data-tab="map">üó∫Ô∏è Issues Map</button>
            <button class="tab-btn px-6 py-3 rounded-lg text-sm font-medium mx-1 mb-2 transition-all" data-tab="my-reports">üìã My Reports</button>
            <button class="tab-btn px-6 py-3 rounded-lg text-sm font-medium mx-1 mb-2 transition-all" data-tab="chat">üí¨ Help Chat</button>
            <button class="tab-btn px-6 py-3 rounded-lg text-sm font-medium mx-1 mb-2 transition-all hidden" data-tab="admin" id="adminTab">‚öôÔ∏è Admin Panel</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content fade-in">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Recent Issues -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">Recent Issues</h3>
                        <div class="flex space-x-2">
                            <button class="filter-btn active bg-primary text-white px-3 py-1 rounded-lg text-sm" data-filter="all">All</button>
                            <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="pending">Pending</button>
                            <button class="filter-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm" data-filter="resolved">Resolved</button>
                        </div>
                    </div>
                    <div class="space-y-4" id="recentIssuesList">
                        <!-- Issues will be populated here -->
                    </div>
                </div>

                <!-- Issue Categories & Analytics -->
                <div class="space-y-6">
                    <!-- Categories -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Issue Categories</h3>
                        <div class="space-y-3" id="categoriesList">
                            <!-- Categories will be populated here -->
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Quick Actions</h3>
                        <div class="space-y-3">
                            <button class="w-full bg-accent hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all" onclick="switchTab('report')">
                                üì± Report New Issue
                            </button>
                            <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium transition-all" onclick="switchTab('map')">
                                üó∫Ô∏è View Issues Map
                            </button>
                            <button class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-medium transition-all" onclick="switchTab('chat')">
                                üí¨ Get Help
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Issue Tab -->
        <div id="report" class="tab-content hidden">
            <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-8">
                <h3 class="text-3xl font-bold text-gray-800 mb-8 text-center">Report a Civic Issue</h3>
                <form id="reportForm" class="space-y-8">
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Left Column -->
                        <div class="space-y-6">
                            <!-- Category Selection -->
                            <div>
                                <label class="block text-lg font-semibold text-gray-700 mb-4">Issue Category</label>
                                <div class="grid grid-cols-2 gap-3" id="categoryGrid">
                                    <!-- Category buttons will be populated here -->
                                </div>
                                <input type="hidden" id="selectedCategory" required>
                            </div>

                            <!-- Priority Level -->
                            <div>
                                <label class="block text-lg font-semibold text-gray-700 mb-4">Priority Level</label>
                                <div class="flex space-x-4">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="radio" name="priority" value="low" class="mr-3 w-4 h-4" checked>
                                        <span class="flex items-center text-green-600 font-medium">üü¢ Low</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <input type="radio" name="priority" value="medium" class="mr-3 w-4 h-4">
                                        <span class="flex items-center text-yellow-600 font-medium">üü° Medium</span>
                                    </label>
                                    <label class="flex items-center cursor-pointer">
                                        <input type="radio" name="priority" value="high" class="mr-3 w-4 h-4">
                                        <span class="flex items-center text-red-600 font-medium">üî¥ High</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Location -->
                            <div>
                                <label class="block text-lg font-semibold text-gray-700 mb-3">Location</label>
                                <div class="flex space-x-3">
                                    <input type="text" id="location" class="flex-1 p-4 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-lg" placeholder="Enter address or landmark" required>
                                    <button type="button" id="getCurrentLocation" class="bg-accent hover:bg-green-600 text-white px-6 py-4 rounded-lg font-medium">üìç GPS</button>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="space-y-6">
                            <!-- Description -->
                            <div>
                                <label class="block text-lg font-semibold text-gray-700 mb-3">Description</label>
                                <textarea id="description" rows="6" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent text-lg" placeholder="Describe the issue in detail..." required></textarea>
                            </div>

                            <!-- Media Upload -->
                            <div>
                                <label class="block text-lg font-semibold text-gray-700 mb-3">Photos/Videos</label>
                                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary transition-colors">
                                    <input type="file" id="mediaUpload" accept="image/*,video/*" multiple class="hidden">
                                    <button type="button" id="mediaBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-medium">
                                        üì∑ Add Photos/Videos
                                    </button>
                                    <p class="text-sm text-gray-500 mt-2">Support: JPG, PNG, MP4 (Max 10MB each)</p>
                                    <div id="mediaPreview" class="mt-4 grid grid-cols-2 gap-2 hidden">
                                        <!-- Media previews will appear here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Options -->
                    <div class="border-t pt-6">
                        <div class="flex flex-wrap items-center justify-between">
                            <div class="flex items-center space-x-6">
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox" id="anonymous" class="mr-3 w-4 h-4">
                                    <span class="text-gray-700">Report anonymously</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox" id="urgent" class="mr-3 w-4 h-4">
                                    <span class="text-red-600 font-medium">Mark as urgent</span>
                                </label>
                            </div>
                            <div class="flex space-x-4 mt-4 sm:mt-0">
                                <button type="button" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium">Save Draft</button>
                                <button type="submit" class="bg-primary hover:bg-secondary text-white px-8 py-3 rounded-lg font-semibold text-lg shadow-lg">
                                    Submit Report
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Issues Map Tab -->
        <div id="map" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 md:mb-0">Issues Map</h3>
                    <div class="flex flex-wrap gap-2">
                        <select id="mapCategoryFilter" class="px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="all">All Categories</option>
                            <option value="potholes">Potholes</option>
                            <option value="garbage">Garbage</option>
                            <option value="streetlights">Streetlights</option>
                            <option value="stray-animals">Stray Animals</option>
                        </select>
                        <select id="mapStatusFilter" class="px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                        </select>
                    </div>
                </div>
                
                <!-- Map Container -->
                <div class="bg-gradient-to-br from-green-100 to-blue-100 h-96 rounded-xl flex items-center justify-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-green-200 via-blue-200 to-purple-200"></div>
                    <div class="relative z-10 text-center">
                        <div class="text-6xl mb-4">üó∫Ô∏è</div>
                        <p class="text-gray-700 font-bold text-xl">Interactive Issues Map</p>
                        <p class="text-gray-600">Click markers to view details and vote</p>
                    </div>
                    
                    <!-- Sample Issue Markers -->
                    <div class="absolute top-1/4 left-1/3 w-6 h-6 bg-red-500 rounded-full pulse-marker cursor-pointer shadow-lg" title="High Priority: Large pothole on Main St - 23 votes" onclick="showIssueDetails('CR-2024-001')"></div>
                    <div class="absolute top-1/2 right-1/4 w-6 h-6 bg-yellow-500 rounded-full pulse-marker cursor-pointer shadow-lg" title="Medium Priority: Broken streetlight - 12 votes" onclick="showIssueDetails('CR-2024-002')"></div>
                    <div class="absolute bottom-1/3 left-1/2 w-6 h-6 bg-green-500 rounded-full cursor-pointer shadow-lg" title="Resolved: Garbage collection completed - 8 votes" onclick="showIssueDetails('CR-2024-003')"></div>
                    <div class="absolute top-3/4 right-1/3 w-6 h-6 bg-blue-500 rounded-full pulse-marker cursor-pointer shadow-lg" title="In Progress: Stray dog rescue - 15 votes" onclick="showIssueDetails('CR-2024-004')"></div>
                </div>

                <!-- Map Legend -->
                <div class="mt-6 flex flex-wrap justify-center gap-4">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-500 rounded-full mr-2"></div>
                        <span class="text-sm">High Priority</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-yellow-500 rounded-full mr-2"></div>
                        <span class="text-sm">Medium Priority</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-blue-500 rounded-full mr-2"></div>
                        <span class="text-sm">In Progress</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-green-500 rounded-full mr-2"></div>
                        <span class="text-sm">Resolved</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Reports Tab -->
        <div id="my-reports" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">My Reports</h3>
                <div id="userReportsList" class="space-y-6">
                    <!-- User reports will be populated here -->
                </div>
            </div>
        </div>

        <!-- Help Chat Tab -->
        <div id="chat" class="tab-content hidden">
            <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Live Help & Support</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <!-- Chat Window -->
                    <div class="md:col-span-2">
                        <div class="border-2 border-gray-200 rounded-lg h-96 flex flex-col">
                            <div class="bg-primary text-white p-4 rounded-t-lg">
                                <h4 class="font-semibold">CivicSense Support</h4>
                                <p class="text-sm opacity-90">We're here to help you report issues effectively</p>
                            </div>
                            <div class="flex-1 p-4 overflow-y-auto" id="chatMessages">
                                <div class="space-y-4">
                                    <div class="flex">
                                        <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                                            <p class="text-sm">Hello! How can I help you today?</p>
                                            <span class="text-xs text-gray-500">Support Agent ‚Ä¢ 2 min ago</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 border-t">
                                <div class="flex space-x-2">
                                    <input type="text" id="chatInput" class="flex-1 p-3 border border-gray-300 rounded-lg" placeholder="Type your message...">
                                    <button id="sendChatBtn" class="bg-primary hover:bg-secondary text-white px-6 py-3 rounded-lg">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- FAQ & Quick Help -->
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">Quick Help</h4>
                            <div class="space-y-2">
                                <button class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-sm">How to report an issue?</button>
                                <button class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-sm">Track my report status</button>
                                <button class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-sm">Update my profile</button>
                                <button class="w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg text-sm">Emergency reporting</button>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">Contact Info</h4>
                            <div class="space-y-2 text-sm text-gray-600">
                                <p>üìû Helpline: 1800-CIVIC-HELP</p>
                                <p>üìß Email: support@civicsense.gov</p>
                                <p>‚è∞ Available: 24/7</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Panel Tab -->
        <div id="admin" class="tab-content hidden">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Analytics Dashboard -->
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">Analytics Dashboard</h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <canvas id="issuesChart" width="400" height="200"></canvas>
                            </div>
                            <div>
                                <canvas id="categoryChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Issues Management -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Pending Issues</h3>
                        <div id="adminPendingIssues" class="space-y-4">
                            <!-- Admin issues will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Admin Controls -->
                <div class="space-y-6">
                    <!-- Quick Stats -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Quick Stats</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                <span class="text-red-700">High Priority</span>
                                <span class="font-bold text-red-700">12</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                                <span class="text-yellow-700">Pending Assignment</span>
                                <span class="font-bold text-yellow-700">28</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                <span class="text-blue-700">In Progress</span>
                                <span class="font-bold text-blue-700">45</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                <span class="text-green-700">Resolved Today</span>
                                <span class="font-bold text-green-700">23</span>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Actions -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Admin Actions</h3>
                        <div class="space-y-3">
                            <button class="w-full bg-primary hover:bg-secondary text-white py-3 rounded-lg font-medium">üìä Generate Report</button>
                            <button class="w-full bg-accent hover:bg-green-600 text-white py-3 rounded-lg font-medium">üì¢ Send Alert</button>
                            <button class="w-full bg-purple-500 hover:bg-purple-600 text-white py-3 rounded-lg font-medium">üë• Manage Users</button>
                            <button class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-medium">‚öôÔ∏è System Settings</button>
                        </div>
                    </div>

                    <!-- Emergency Alerts -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Emergency Alerts</h3>
                        <textarea class="w-full p-3 border border-gray-300 rounded-lg mb-3" rows="3" placeholder="Type emergency alert message..."></textarea>
                        <button class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-medium">üö® Send Emergency Alert</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-8 w-full max-w-md slide-up">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">Login to CivicSense</h3>
            <form id="loginForm" class="space-y-6">
                <input type="email" placeholder="Email Address" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                <input type="password" placeholder="Password" class="w-full p-4 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" required>
                <button type="submit" class="w-full bg-primary hover:bg-secondary text-white py-4 rounded-lg font-semibold text-lg">Login</button>
            </form>
            <div class="mt-6 text-center">
                <p class="text-gray-600 mb-4">Or login with:</p>
                <div class="flex space-x-3">
                    <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium">üìò Facebook</button>
                    <button class="flex-1 bg-red-600 hover:bg-red-700 text-white py-3 rounded-lg font-medium">üîç Google</button>
                </div>
            </div>
            <button id="closeLoginModal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-8 w-full max-w-md text-center slide-up">
            <div class="text-8xl mb-6">‚úÖ</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Report Submitted Successfully!</h3>
            <p class="text-gray-600 mb-6">Your issue has been forwarded to the municipal corporation. You'll receive real-time updates.</p>
            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                <p class="text-sm font-medium"><strong>Report ID:</strong> <span id="reportId">CR-2024-001</span></p>
                <p class="text-sm text-gray-600 mt-1">Estimated Resolution: <span id="estimatedTime">3-5 days</span></p>
            </div>
            <div class="flex space-x-3">
                <button id="shareReportBtn" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg font-medium">üì± Share</button>
                <button id="trackReportBtn" class="flex-1 bg-accent hover:bg-green-600 text-white py-3 rounded-lg font-medium">üìç Track</button>
                <button id="closeSuccessModal" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 rounded-lg font-medium">Close</button>
            </div>
        </div>
    </div>

    <!-- Issue Details Modal -->
    <div id="issueDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl p-8 w-full max-w-2xl slide-up max-h-screen overflow-y-auto">
            <div class="flex justify-between items-start mb-6">
                <h3 class="text-2xl font-bold text-gray-800">Issue Details</h3>
                <button id="closeIssueModal" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
            </div>
            <div id="issueDetailsContent">
                <!-- Issue details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="fixed top-16 right-4 w-80 bg-white rounded-xl shadow-2xl border hidden z-40 slide-up">
        <div class="p-4 border-b">
            <h4 class="font-semibold text-gray-800">Notifications</h4>
        </div>
        <div class="max-h-96 overflow-y-auto">
            <div class="p-4 border-b hover:bg-gray-50">
                <div class="flex items-start space-x-3">
                    <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                    <div>
                        <p class="text-sm font-medium">Issue CR-2024-001 updated</p>
                        <p class="text-xs text-gray-600">Status changed to "In Progress"</p>
                        <p class="text-xs text-gray-500">2 minutes ago</p>
                    </div>
                </div>
            </div>
            <div class="p-4 border-b hover:bg-gray-50">
                <div class="flex items-start space-x-3">
                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                    <div>
                        <p class="text-sm font-medium">Issue CR-2024-003 resolved</p>
                        <p class="text-xs text-gray-600">Garbage collection completed</p>
                        <p class="text-xs text-gray-500">1 hour ago</p>
                    </div>
                </div>
            </div>
            <div class="p-4 hover:bg-gray-50">
                <div class="flex items-start space-x-3">
                    <div class="w-2 h-2 bg-red-500 rounded-full mt-2"></div>
                    <div>
                        <p class="text-sm font-medium">Emergency Alert</p>
                        <p class="text-xs text-gray-600">Water supply disruption on Main St</p>
                        <p class="text-xs text-gray-500">3 hours ago</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        let issues = [
            {
                id: 'CR-2024-001',
                category: 'potholes',
                title: 'Large pothole causing traffic issues',
                description: 'There is a large pothole on Main Street near the intersection with 5th Avenue. It\'s causing vehicles to swerve and creating traffic congestion.',
                location: 'Main Street & 5th Ave',
                priority: 'high',
                status: 'in-progress',
                date: '2024-01-15',
                reporter: 'John Doe',
                assignedTo: 'Road Maintenance Team',
                votes: 23,
                comments: 8,
                estimatedResolution: '2-3 days',
                timeline: [
                    { status: 'reported', date: '2024-01-15', time: '09:30 AM', description: 'Issue reported by citizen' },
                    { status: 'assigned', date: '2024-01-15', time: '11:45 AM', description: 'Assigned to Road Maintenance Team' },
                    { status: 'in-progress', date: '2024-01-16', time: '08:00 AM', description: 'Work started on site' }
                ]
            },
            {
                id: 'CR-2024-002',
                category: 'streetlights',
                title: 'Broken streetlight in residential area',
                description: 'The streetlight at Oak Street Park has been non-functional for over a week, making the area unsafe at night.',
                location: 'Oak Street Park',
                priority: 'medium',
                status: 'pending',
                date: '2024-01-14',
                reporter: 'Jane Smith',
                assignedTo: null,
                votes: 12,
                comments: 3,
                estimatedResolution: '3-5 days',
                timeline: [
                    { status: 'reported', date: '2024-01-14', time: '07:20 PM', description: 'Issue reported by citizen' }
                ]
            },
            {
                id: 'CR-2024-003',
                category: 'garbage',
                title: 'Overflowing garbage bins',
                description: 'Garbage bins on Pine Avenue have been overflowing for a week. The waste is attracting pests and creating health hazards.',
                location: 'Pine Avenue',
                priority: 'medium',
                status: 'resolved',
                date: '2024-01-10',
                reporter: 'Mike Johnson',
                assignedTo: 'Waste Management',
                votes: 8,
                comments: 5,
                estimatedResolution: 'Completed',
                timeline: [
                    { status: 'reported', date: '2024-01-10', time: '02:15 PM', description: 'Issue reported by citizen' },
                    { status: 'assigned', date: '2024-01-10', time: '04:30 PM', description: 'Assigned to Waste Management' },
                    { status: 'in-progress', date: '2024-01-11', time: '09:00 AM', description: 'Collection team dispatched' },
                    { status: 'resolved', date: '2024-01-11', time: '11:30 AM', description: 'Garbage collected and area cleaned' }
                ]
            }
        ];

        let currentUser = null;
        let isAdmin = false;
        let selectedCategory = null;

        const categories = [
            { id: 'potholes', name: 'Potholes', icon: 'üï≥Ô∏è', count: 45 },
            { id: 'garbage', name: 'Garbage', icon: 'üóëÔ∏è', count: 32 },
            { id: 'streetlights', name: 'Streetlights', icon: 'üí°', count: 28 },
            { id: 'stray-animals', name: 'Stray Animals', icon: 'üêï', count: 19 },
            { id: 'illegal-dumping', name: 'Illegal Dumping', icon: 'üö´', count: 15 },
            { id: 'water-leakage', name: 'Water Leakage', icon: 'üíß', count: 12 },
            { id: 'noise-pollution', name: 'Noise Pollution', icon: 'üîä', count: 8 },
            { id: 'parking-violations', name: 'Parking Violations', icon: 'üöó', count: 6 }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            populateCategories();
            populateRecentIssues();
            populateUserReports();
            populateAdminIssues();
            initializeCharts();
        });

        function initializeApp() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    switchTab(tabId);
                });
            });

            // Modal handlers
            document.getElementById('loginBtn').addEventListener('click', () => {
                document.getElementById('loginModal').classList.remove('hidden');
            });

            document.getElementById('closeLoginModal').addEventListener('click', () => {
                document.getElementById('loginModal').classList.add('hidden');
            });

            document.getElementById('closeSuccessModal').addEventListener('click', () => {
                document.getElementById('successModal').classList.add('hidden');
            });

            document.getElementById('closeIssueModal').addEventListener('click', () => {
                document.getElementById('issueDetailsModal').classList.add('hidden');
            });

            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                simulateLogin();
            });

            // Report form
            document.getElementById('reportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitReport();
            });

            // Media upload
            document.getElementById('mediaBtn').addEventListener('click', () => {
                document.getElementById('mediaUpload').click();
            });

            document.getElementById('mediaUpload').addEventListener('change', function(e) {
                handleMediaUpload(e.target.files);
            });

            // GPS location
            document.getElementById('getCurrentLocation').addEventListener('click', function() {
                getCurrentLocation();
            });

            // Hero buttons
            document.getElementById('heroReportBtn').addEventListener('click', () => {
                switchTab('report');
            });

            document.getElementById('heroViewBtn').addEventListener('click', () => {
                switchTab('map');
            });

            // Notification panel
            document.getElementById('notificationBtn').addEventListener('click', function() {
                const panel = document.getElementById('notificationPanel');
                panel.classList.toggle('hidden');
            });

            // Chat functionality
            document.getElementById('sendChatBtn').addEventListener('click', sendChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });

            // Share report
            document.getElementById('shareReportBtn').addEventListener('click', shareReport);

            // Track report
            document.getElementById('trackReportBtn').addEventListener('click', function() {
                document.getElementById('successModal').classList.add('hidden');
                switchTab('my-reports');
            });

            // Emergency button
            document.getElementById('emergencyBtn').addEventListener('click', function() {
                alert('üö® Emergency services contacted! For immediate assistance, call 911 or your local emergency number.');
            });

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const filter = this.dataset.filter;
                    filterIssues(filter);
                    
                    // Update active state
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('active', 'bg-primary', 'text-white');
                        b.classList.add('bg-gray-200', 'text-gray-700');
                    });
                    this.classList.add('active', 'bg-primary', 'text-white');
                    this.classList.remove('bg-gray-200', 'text-gray-700');
                });
            });

            // Logout functionality
            document.getElementById('logoutBtn').addEventListener('click', logout);
        }

        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-primary', 'text-white');
                btn.classList.add('text-gray-700', 'hover:text-primary');
            });

            // Show selected tab
            document.getElementById(tabId).classList.remove('hidden');
            document.getElementById(tabId).classList.add('fade-in');

            // Add active class to selected button
            const activeBtn = document.querySelector(`[data-tab="${tabId}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'bg-primary', 'text-white');
                activeBtn.classList.remove('text-gray-700', 'hover:text-primary');
            }
        }

        function populateCategories() {
            // Populate category grid in report form
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = categories.map(cat => `
                <button type="button" class="category-btn p-4 border-2 border-gray-200 rounded-lg hover:border-primary hover:bg-blue-50 transition-all text-center" data-category="${cat.id}">
                    <div class="text-2xl mb-2">${cat.icon}</div>
                    <div class="text-sm font-medium">${cat.name}</div>
                </button>
            `).join('');

            // Add click handlers for category buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active state from all buttons
                    document.querySelectorAll('.category-btn').forEach(b => {
                        b.classList.remove('border-primary', 'bg-blue-50');
                        b.classList.add('border-gray-200');
                    });
                    
                    // Add active state to clicked button
                    this.classList.add('border-primary', 'bg-blue-50');
                    this.classList.remove('border-gray-200');
                    
                    // Set selected category
                    selectedCategory = this.dataset.category;
                    document.getElementById('selectedCategory').value = selectedCategory;
                });
            });

            // Populate categories list in dashboard
            const categoriesList = document.getElementById('categoriesList');
            categoriesList.innerHTML = categories.slice(0, 6).map(cat => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <span class="flex items-center">
                        <span class="text-xl mr-3">${cat.icon}</span>
                        <span class="font-medium">${cat.name}</span>
                    </span>
                    <span class="bg-primary text-white px-3 py-1 rounded-full text-sm font-medium">${cat.count}</span>
                </div>
            `).join('');
        }

        function populateRecentIssues() {
            const container = document.getElementById('recentIssuesList');
            const recentIssues = issues.slice(0, 5);

            container.innerHTML = recentIssues.map(issue => `
                <div class="border-l-4 ${getPriorityBorderColor(issue.priority)} bg-white p-6 rounded-r-lg shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">${getCategoryIcon(issue.category)}</span>
                                <h4 class="font-bold text-lg text-gray-800">${issue.title}</h4>
                            </div>
                            <p class="text-gray-600 mb-2">${issue.description.substring(0, 100)}...</p>
                            <div class="flex items-center text-sm text-gray-500 space-x-4">
                                <span>üìç ${issue.location}</span>
                                <span>üìÖ ${issue.date}</span>
                                <span>üë§ ${issue.reporter}</span>
                            </div>
                        </div>
                        <div class="flex flex-col items-end space-y-2">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(issue.status)}">${issue.status.toUpperCase()}</span>
                            <div class="flex items-center space-x-2 text-sm text-gray-500">
                                <span>üëç ${issue.votes}</span>
                                <span>üí¨ ${issue.comments}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="showIssueDetails('${issue.id}')" class="text-primary hover:text-secondary text-sm font-medium">View Details</button>
                        <button onclick="voteForIssue('${issue.id}')" class="text-accent hover:text-green-600 text-sm font-medium">üëç Vote</button>
                        <button onclick="shareIssue('${issue.id}')" class="text-blue-500 hover:text-blue-600 text-sm font-medium">üì± Share</button>
                    </div>
                </div>
            `).join('');
        }

        function populateUserReports() {
            const container = document.getElementById('userReportsList');
            if (!currentUser) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üîê</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">Login Required</h3>
                        <p class="text-gray-500 mb-6">Please login to view and track your reports</p>
                        <button onclick="document.getElementById('loginModal').classList.remove('hidden')" class="bg-primary hover:bg-secondary text-white px-6 py-3 rounded-lg font-medium">Login Now</button>
                    </div>
                `;
                return;
            }

            const userIssues = issues.filter(issue => issue.reporter === currentUser.name);
            
            if (userIssues.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üìù</div>
                        <h3 class="text-xl font-semibold text-gray-700 mb-2">No Reports Yet</h3>
                        <p class="text-gray-500 mb-6">You haven't reported any issues yet. Start making your community better!</p>
                        <button onclick="switchTab('report')" class="bg-accent hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium">Report First Issue</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = userIssues.map(issue => `
                <div class="bg-white border rounded-xl p-6 shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3">${getCategoryIcon(issue.category)}</span>
                            <div>
                                <h4 class="font-bold text-lg text-gray-800">${issue.title}</h4>
                                <p class="text-sm text-gray-500">ID: ${issue.id}</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(issue.status)}">${issue.status.toUpperCase()}</span>
                    </div>
                    
                    <p class="text-gray-600 mb-4">${issue.description}</p>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div class="text-sm text-gray-500">
                            <p><strong>Location:</strong> ${issue.location}</p>
                            <p><strong>Priority:</strong> <span class="capitalize ${getPriorityTextColor(issue.priority)}">${issue.priority}</span></p>
                            <p><strong>Reported:</strong> ${issue.date}</p>
                        </div>
                        <div class="text-sm text-gray-500">
                            <p><strong>Assigned to:</strong> ${issue.assignedTo || 'Pending'}</p>
                            <p><strong>Estimated Resolution:</strong> ${issue.estimatedResolution}</p>
                            <p><strong>Community Support:</strong> ${issue.votes} votes, ${issue.comments} comments</p>
                        </div>
                    </div>

                    <!-- Timeline -->
                    <div class="mb-4">
                        <h5 class="font-semibold text-gray-700 mb-3">Progress Timeline</h5>
                        <div class="timeline-line">
                            ${issue.timeline.map((item, index) => `
                                <div class="timeline-item mb-3">
                                    <div class="timeline-dot ${getTimelineColor(item.status)}"></div>
                                    <div class="bg-gray-50 p-3 rounded-lg">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <p class="font-medium text-sm capitalize">${item.status.replace('-', ' ')}</p>
                                                <p class="text-xs text-gray-600">${item.description}</p>
                                            </div>
                                            <div class="text-xs text-gray-500">
                                                <p>${item.date}</p>
                                                <p>${item.time}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2">
                        <button onclick="showIssueDetails('${issue.id}')" class="bg-primary hover:bg-secondary text-white px-4 py-2 rounded-lg text-sm font-medium">View Details</button>
                        <button onclick="shareIssue('${issue.id}')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium">üì± Share</button>
                        ${issue.status === 'resolved' ? `<button onclick="rateResolution('${issue.id}')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg text-sm font-medium">‚≠ê Rate</button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        function populateAdminIssues() {
            const container = document.getElementById('adminPendingIssues');
            if (!isAdmin) return;

            const pendingIssues = issues.filter(issue => issue.status === 'pending' || issue.status === 'in-progress');

            container.innerHTML = pendingIssues.map(issue => `
                <div class="border rounded-lg p-4 bg-white hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center">
                            <span class="text-xl mr-2">${getCategoryIcon(issue.category)}</span>
                            <div>
                                <h5 class="font-semibold text-gray-800">${issue.title}</h5>
                                <p class="text-xs text-gray-500">ID: ${issue.id} ‚Ä¢ ${issue.location}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 rounded text-xs font-medium ${getPriorityColor(issue.priority)} text-white">${issue.priority}</span>
                            <span class="px-2 py-1 rounded text-xs ${getStatusColor(issue.status)}">${issue.status}</span>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-600 mb-3">${issue.description.substring(0, 120)}...</p>
                    
                    <div class="flex items-center justify-between text-xs text-gray-500 mb-3">
                        <span>üë§ ${issue.reporter}</span>
                        <span>üìÖ ${issue.date}</span>
                        <span>üëç ${issue.votes} votes</span>
                    </div>

                    <div class="flex space-x-2">
                        ${issue.status === 'pending' ? `
                            <button onclick="updateIssueStatus('${issue.id}', 'in-progress')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-medium">Assign</button>
                        ` : ''}
                        <button onclick="updateIssueStatus('${issue.id}', 'resolved')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-xs font-medium">Resolve</button>
                        <button onclick="showIssueDetails('${issue.id}')" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs font-medium">Details</button>
                    </div>
                </div>
            `).join('');
        }

        function simulateLogin() {
            // Simulate login process
            currentUser = {
                name: 'John Doe',
                email: 'john@example.com',
                isAdmin: Math.random() > 0.6 // 40% chance of admin
            };

            isAdmin = currentUser.isAdmin;

            // Update UI
            document.getElementById('loginBtn').classList.add('hidden');
            document.getElementById('signupBtn').classList.add('hidden');
            document.getElementById('userMenu').classList.remove('hidden');
            document.getElementById('userName').textContent = currentUser.name;

            if (isAdmin) {
                document.getElementById('adminTab').classList.remove('hidden');
            }

            document.getElementById('loginModal').classList.add('hidden');

            // Show success message
            setTimeout(() => {
                alert(`Welcome back, ${currentUser.name}!${isAdmin ? ' You have admin privileges.' : ''}`);
            }, 300);

            // Refresh user-specific content
            populateUserReports();
            populateAdminIssues();
        }

        function logout() {
            currentUser = null;
            isAdmin = false;
            
            document.getElementById('loginBtn').classList.remove('hidden');
            document.getElementById('signupBtn').classList.remove('hidden');
            document.getElementById('userMenu').classList.add('hidden');
            document.getElementById('adminTab').classList.add('hidden');
            
            switchTab('dashboard');
            populateUserReports();
        }

        function submitReport() {
            if (!selectedCategory) {
                alert('Please select an issue category');
                return;
            }

            const formData = {
                id: `CR-2024-${String(issues.length + 1).padStart(3, '0')}`,
                category: selectedCategory,
                title: document.getElementById('description').value.substring(0, 50) + '...',
                description: document.getElementById('description').value,
                location: document.getElementById('location').value,
                priority: document.querySelector('input[name="priority"]:checked').value,
                status: 'pending',
                date: new Date().toISOString().split('T')[0],
                reporter: currentUser ? currentUser.name : 'Anonymous User',
                assignedTo: null,
                votes: 0,
                comments: 0,
                estimatedResolution: getEstimatedResolution(selectedCategory, document.querySelector('input[name="priority"]:checked').value),
                timeline: [
                    {
                        status: 'reported',
                        date: new Date().toISOString().split('T')[0],
                        time: new Date().toLocaleTimeString(),
                        description: 'Issue reported by citizen'
                    }
                ]
            };

            // Add to issues array
            issues.unshift(formData);

            // Update report ID in modal
            document.getElementById('reportId').textContent = formData.id;
            document.getElementById('estimatedTime').textContent = formData.estimatedResolution;

            // Show success modal
            document.getElementById('successModal').classList.remove('hidden');

            // Reset form
            document.getElementById('reportForm').reset();
            document.getElementById('mediaPreview').classList.add('hidden');
            selectedCategory = null;
            
            // Reset category buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('border-primary', 'bg-blue-50');
                btn.classList.add('border-gray-200');
            });

            // Update displays
            populateRecentIssues();
            populateUserReports();
            populateAdminIssues();
            updateStats();
        }

        function handleMediaUpload(files) {
            const preview = document.getElementById('mediaPreview');
            preview.innerHTML = '';
            preview.classList.remove('hidden');

            Array.from(files).forEach(file => {
                const div = document.createElement('div');
                div.className = 'relative';
                
                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.className = 'w-full h-24 object-cover rounded-lg';
                    div.appendChild(img);
                } else if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = URL.createObjectURL(file);
                    video.className = 'w-full h-24 object-cover rounded-lg';
                    video.controls = true;
                    div.appendChild(video);
                }
                
                preview.appendChild(div);
            });
        }

        function getCurrentLocation() {
            const btn = document.getElementById('getCurrentLocation');
            if (navigator.geolocation) {
                btn.innerHTML = 'üìç Getting...';
                btn.disabled = true;
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude.toFixed(6);
                        const lng = position.coords.longitude.toFixed(6);
                        document.getElementById('location').value = `GPS: ${lat}, ${lng}`;
                        btn.innerHTML = 'üìç GPS';
                        btn.disabled = false;
                    },
                    (error) => {
                        alert('Unable to get location. Please enter manually.');
                        btn.innerHTML = 'üìç GPS';
                        btn.disabled = false;
                    }
                );
            } else {
                alert('Geolocation not supported by this browser.');
            }
        }

        function showIssueDetails(issueId) {
            const issue = issues.find(i => i.id === issueId);
            if (!issue) return;

            const modal = document.getElementById('issueDetailsModal');
            const content = document.getElementById('issueDetailsContent');
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="flex items-start justify-between">
                        <div class="flex items-center">
                            <span class="text-3xl mr-4">${getCategoryIcon(issue.category)}</span>
                            <div>
                                <h4 class="text-xl font-bold text-gray-800">${issue.title}</h4>
                                <p class="text-sm text-gray-500">ID: ${issue.id}</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${getPriorityColor(issue.priority)} text-white">${issue.priority}</span>
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(issue.status)}">${issue.status.toUpperCase()}</span>
                        </div>
                    </div>

                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h5 class="font-semibold mb-2">Description</h5>
                        <p class="text-gray-700">${issue.description}</p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-semibold mb-2">Issue Details</h5>
                            <div class="space-y-1 text-sm">
                                <p><strong>Location:</strong> ${issue.location}</p>
                                <p><strong>Reported by:</strong> ${issue.reporter}</p>
                                <p><strong>Date:</strong> ${issue.date}</p>
                                <p><strong>Priority:</strong> <span class="capitalize ${getPriorityTextColor(issue.priority)}">${issue.priority}</span></p>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h5 class="font-semibold mb-2">Status Information</h5>
                            <div class="space-y-1 text-sm">
                                <p><strong>Current Status:</strong> ${issue.status}</p>
                                <p><strong>Assigned to:</strong> ${issue.assignedTo || 'Pending assignment'}</p>
                                <p><strong>Estimated Resolution:</strong> ${issue.estimatedResolution}</p>
                                <p><strong>Community Support:</strong> ${issue.votes} votes, ${issue.comments} comments</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h5 class="font-semibold mb-3">Progress Timeline</h5>
                        <div class="timeline-line">
                            ${issue.timeline.map(item => `
                                <div class="timeline-item mb-3">
                                    <div class="timeline-dot ${getTimelineColor(item.status)}"></div>
                                    <div class="bg-white p-3 rounded-lg shadow-sm">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <p class="font-medium text-sm capitalize">${item.status.replace('-', ' ')}</p>
                                                <p class="text-xs text-gray-600">${item.description}</p>
                                            </div>
                                            <div class="text-xs text-gray-500 text-right">
                                                <p>${item.date}</p>
                                                <p>${item.time}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <button onclick="voteForIssue('${issue.id}')" class="bg-accent hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium">üëç Vote (${issue.votes})</button>
                        <button onclick="shareIssue('${issue.id}')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium">üì± Share</button>
                        <button class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-medium">üí¨ Comment</button>
                        ${issue.status === 'resolved' ? `<button onclick="rateResolution('${issue.id}')" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg font-medium">‚≠ê Rate Resolution</button>` : ''}
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function updateIssueStatus(issueId, newStatus) {
            const issue = issues.find(i => i.id === issueId);
            if (!issue) return;

            const oldStatus = issue.status;
            issue.status = newStatus;
            
            // Add timeline entry
            const timelineEntry = {
                status: newStatus,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString(),
                description: getStatusDescription(newStatus)
            };
            
            if (newStatus === 'in-progress' && !issue.assignedTo) {
                issue.assignedTo = 'Municipal Team';
                timelineEntry.description = 'Assigned to Municipal Team and work started';
            }
            
            issue.timeline.push(timelineEntry);

            // Update estimated resolution
            if (newStatus === 'resolved') {
                issue.estimatedResolution = 'Completed';
            }

            // Refresh displays
            populateRecentIssues();
            populateUserReports();
            populateAdminIssues();
            updateStats();
            
            // Show notification
            alert(`Issue ${issueId} status updated from "${oldStatus}" to "${newStatus}"`);
        }

        function voteForIssue(issueId) {
            const issue = issues.find(i => i.id === issueId);
            if (issue) {
                issue.votes++;
                populateRecentIssues();
                populateUserReports();
                alert(`Thank you for voting! This issue now has ${issue.votes} votes.`);
            }
        }

        function shareIssue(issueId) {
            const issue = issues.find(i => i.id === issueId);
            if (!issue) return;

            const shareText = `üèõÔ∏è CivicSense Issue Report\n\n${getCategoryIcon(issue.category)} ${issue.title}\nüìç ${issue.location}\n\nHelp resolve this civic issue by voting and sharing!\n\nReport ID: ${issue.id}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'CivicSense Issue Report',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText + '\n\n' + window.location.href).then(() => {
                    alert('Issue details copied to clipboard! Share it on social media to raise awareness.');
                });
            }
        }

        function shareReport() {
            const reportId = document.getElementById('reportId').textContent;
            const shareText = `üèõÔ∏è I just reported a civic issue on CivicSense!\n\nReport ID: ${reportId}\n\nJoin me in making our community better by reporting and tracking local issues.\n\n#CivicSense #CommunityFirst`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'CivicSense Report',
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText + '\n\n' + window.location.href).then(() => {
                    alert('Report details copied to clipboard!');
                });
            }
        }

        function rateResolution(issueId) {
            const rating = prompt('Rate the resolution quality (1-5 stars):');
            if (rating && rating >= 1 && rating <= 5) {
                alert(`Thank you for rating! You gave ${rating} stars for the resolution.`);
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            const chatMessages = document.getElementById('chatMessages');
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'flex justify-end mb-4';
            userMsg.innerHTML = `
                <div class="bg-primary text-white rounded-lg p-3 max-w-xs">
                    <p class="text-sm">${message}</p>
                    <span class="text-xs opacity-75">You ‚Ä¢ now</span>
                </div>
            `;
            chatMessages.appendChild(userMsg);

            // Clear input
            input.value = '';

            // Simulate response
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'flex mb-4';
                botMsg.innerHTML = `
                    <div class="bg-gray-100 rounded-lg p-3 max-w-xs">
                        <p class="text-sm">Thank you for your message. Our support team will help you with "${message}". Is there anything specific you'd like to know about reporting issues?</p>
                        <span class="text-xs text-gray-500">Support Agent ‚Ä¢ now</span>
                    </div>
                `;
                chatMessages.appendChild(botMsg);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);

            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function filterIssues(filter) {
            let filteredIssues;
            if (filter === 'all') {
                filteredIssues = issues;
            } else {
                filteredIssues = issues.filter(issue => issue.status === filter);
            }

            // Update the recent issues display with filtered results
            const container = document.getElementById('recentIssuesList');
            container.innerHTML = filteredIssues.slice(0, 10).map(issue => `
                <div class="border-l-4 ${getPriorityBorderColor(issue.priority)} bg-white p-6 rounded-r-lg shadow-sm hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-3">${getCategoryIcon(issue.category)}</span>
                                <h4 class="font-bold text-lg text-gray-800">${issue.title}</h4>
                            </div>
                            <p class="text-gray-600 mb-2">${issue.description.substring(0, 100)}...</p>
                            <div class="flex items-center text-sm text-gray-500 space-x-4">
                                <span>üìç ${issue.location}</span>
                                <span>üìÖ ${issue.date}</span>
                                <span>üë§ ${issue.reporter}</span>
                            </div>
                        </div>
                        <div class="flex flex-col items-end space-y-2">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${getStatusColor(issue.status)}">${issue.status.toUpperCase()}</span>
                            <div class="flex items-center space-x-2 text-sm text-gray-500">
                                <span>üëç ${issue.votes}</span>
                                <span>üí¨ ${issue.comments}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="showIssueDetails('${issue.id}')" class="text-primary hover:text-secondary text-sm font-medium">View Details</button>
                        <button onclick="voteForIssue('${issue.id}')" class="text-accent hover:text-green-600 text-sm font-medium">üëç Vote</button>
                        <button onclick="shareIssue('${issue.id}')" class="text-blue-500 hover:text-blue-600 text-sm font-medium">üì± Share</button>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            const total = issues.length;
            const resolved = issues.filter(i => i.status === 'resolved').length;
            const avgTime = 2.3; // Simulated
            const satisfaction = 4.8; // Simulated

            document.getElementById('totalIssues').textContent = total.toLocaleString();
            document.getElementById('resolvedIssues').textContent = resolved.toLocaleString();
            document.getElementById('avgResolutionTime').textContent = avgTime;
            document.getElementById('userSatisfaction').textContent = satisfaction;
        }

        function initializeCharts() {
            // Issues Chart
            const issuesCtx = document.getElementById('issuesChart');
            if (issuesCtx) {
                new Chart(issuesCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Issues Reported',
                            data: [65, 59, 80, 81, 56, 55],
                            borderColor: '#1e40af',
                            backgroundColor: 'rgba(30, 64, 175, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Issues Resolved',
                            data: [45, 49, 70, 71, 46, 45],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Issues Trend'
                            }
                        }
                    }
                });
            }

            // Category Chart
            const categoryCtx = document.getElementById('categoryChart');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Potholes', 'Garbage', 'Streetlights', 'Stray Animals', 'Others'],
                        datasets: [{
                            data: [45, 32, 28, 19, 23],
                            backgroundColor: [
                                '#ef4444',
                                '#f59e0b',
                                '#3b82f6',
                                '#10b981',
                                '#8b5cf6'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Issues by Category'
                            }
                        }
                    }
                });
            }
        }

        // Utility functions
        function getCategoryIcon(category) {
            const icons = {
                'potholes': 'üï≥Ô∏è',
                'garbage': 'üóëÔ∏è',
                'streetlights': 'üí°',
                'stray-animals': 'üêï',
                'illegal-dumping': 'üö´',
                'water-leakage': 'üíß',
                'noise-pollution': 'üîä',
                'parking-violations': 'üöó',
                'other': 'üîß'
            };
            return icons[category] || 'üìù';
        }

        function getPriorityBorderColor(priority) {
            const colors = {
                'low': 'border-green-500',
                'medium': 'border-yellow-500',
                'high': 'border-red-500'
            };
            return colors[priority] || 'border-gray-500';
        }

        function getPriorityColor(priority) {
            const colors = {
                'low': 'bg-green-500',
                'medium': 'bg-yellow-500',
                'high': 'bg-red-500'
            };
            return colors[priority] || 'bg-gray-500';
        }

        function getPriorityTextColor(priority) {
            const colors = {
                'low': 'text-green-600',
                'medium': 'text-yellow-600',
                'high': 'text-red-600'
            };
            return colors[priority] || 'text-gray-600';
        }

        function getStatusColor(status) {
            const colors = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'in-progress': 'bg-blue-100 text-blue-800',
                'resolved': 'bg-green-100 text-green-800'
            };
            return colors[status] || 'bg-gray-100 text-gray-800';
        }

        function getTimelineColor(status) {
            const colors = {
                'reported': 'bg-blue-500',
                'assigned': 'bg-yellow-500',
                'in-progress': 'bg-orange-500',
                'resolved': 'bg-green-500'
            };
            return colors[status] || 'bg-gray-500';
        }

        function getEstimatedResolution(category, priority) {
            const baseDays = {
                'potholes': 3,
                'garbage': 1,
                'streetlights': 2,
                'stray-animals': 2,
                'illegal-dumping': 1,
                'water-leakage': 1,
                'noise-pollution': 5,
                'parking-violations': 1
            };

            const priorityMultiplier = {
                'high': 0.5,
                'medium': 1,
                'low': 1.5
            };

            const days = Math.ceil((baseDays[category] || 3) * (priorityMultiplier[priority] || 1));
            return `${days}-${days + 2} days`;
        }

        function getStatusDescription(status) {
            const descriptions = {
                'pending': 'Issue received and under review',
                'assigned': 'Issue assigned to relevant department',
                'in-progress': 'Work started on resolving the issue',
                'resolved': 'Issue has been successfully resolved'
            };
            return descriptions[status] || 'Status updated';
        }

        // Initialize stats
        updateStats();

        // Hide notification panel when clicking outside
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('notificationPanel');
            const btn = document.getElementById('notificationBtn');
            if (!panel.contains(e.target) && !btn.contains(e.target)) {
                panel.classList.add('hidden');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'980a8823f48ac197',t:'MTc1ODEzMjMyNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
